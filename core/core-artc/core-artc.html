<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/core-scroll-header-panel/core-scroll-header-panel.html">
<link rel="import" href="../../bower_components/core-field/core-field.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-input/core-input.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/hero-transition.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/cross-fade.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-down.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-up.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/tile-cascade.html">
<link rel="import" href="../../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/core-tooltip/core-tooltip.html">
<link rel="import" href="../core-ajax-handler.html">

<polymer-element name="core-artc" attributes="htitle,date,bgimg,content,owner,idart,coments">

  <template>

    <link rel="stylesheet" href="core-artc.css">


    <core-card id="core-artc">
        <core-header-panel mode="waterfall-tall" id="core_header_panel">
          <core-toolbar id="core_toolbar" tallClass="medium-tall" class="animate tall" style=" background: url('{{bgimg}}');  background-size:100% 192px;">
            <core-drawer-panel id="core-drawer-panel" responsiveWidth='2100px'>
              <div drawer>
                <paper-tabs id="paper_manager" class="transparent-teal" vertical center layout>
                    <paper-tab on-click="{{dialog}}" id="paper_tab-dw" inline flex center-center horizontal layout>
                  	   <core-icon icon="delete" id="manage-ico"></core-icon>
                       <span id="txt">Delete</span>
                     </paper-tab>
                     <paper-tab on-click="{{edit}}" id="paper_tab-dw" inline flex center-center horizontal layout>
                       <core-icon icon="create" id="manage"></core-icon>
                       <span id="txt">Edit</span>
                     </paper-tab>
                </paper-tabs>
              </div>
              <div main>
                  <div id="div1">
                <template if="{{show}}">
                    <core-icon-button id="menuButton" icon="more-vert" core-drawer-toggle></core-icon-button>
                  </template>
                     <core-icon-button icon="class" id="core_icon_button4"></core-icon-button>
                      {{htitle}}</div>
                  <div id="time">{{date}}</div>
              </div>
            </core-drawer-panel>
          </core-toolbar>
        <div id="section" class="noheight">
          <div id="content" class="cont"></div>
        </div>
        </core-header-panel>

        <!-- comentarios -->

        <ul id="comentarios" class="comentarios">
          <template repeat="{{comentario in coments}}">
            <li class="comentario"><a href="#/pqr/?id={{comentario._id}}">{{comentario.user}}</a> : {{comentario.com}}</li>
          </template>
          <li>
            <paper-tabs selected="0" class="transparent-teal" selectedindex="0" id="comentsadd" class="comentsadd" horizontal center layout>
              <paper-tab id="com-add" on-click="{{createComment}}" inline flex center-center horizontal layout active>
                <core-icon icon="add-circle-outline" id="core_icon_button2"></core-icon>
                <span id="txt">Add</span>
              </paper-tab>
            </paper-tabs>
            <div id="inputcomment" horizontal layout>
              <input id="inputadd" class="inputadd" placeholder="Add new comment" is="core-input" flex>
              <paper-fab icon="create" class="btn" mini='true' on-click="{{sendComent}}" role="button" tabindex="0" aria-label="create" style="overflow: visible;"></paper-fab>
            </div>
          </li>
        </ul>

        <!-- buttons -->

        <paper-tabs selected="0" selectedindex="0" id="paper_tabs" class="transparent-teal" horizontal center layout>
          <paper-tab id="paper_tab1" inline flex center-center horizontal layout active>
            <core-icon icon="favorite-outline" id="core_icon_button2"></core-icon>
            <span id="txt">Like</span>
          </paper-tab>
          <paper-tab on-click="{{visiblecomments}}" id="paper_tab2" inline flex center-center horizontal layout>
            <core-icon icon="announcement" id="core_icon_button2"></core-icon>
            <span id="txt">Comment</span>
          </paper-tab>
          <paper-tab on-click="{{dialog}}" id="paper_tab3" inline flex center-center horizontal layout>
                     <core-icon icon="face-unlock" id="core_icon_button2"></core-icon>
                     <span id="txt">Share</span>
          </paper-tab>
        </paper-tabs>
    </core-card>

    <core-ajax-handler id="ajaxhandler"></core-ajax-handler>

    <!--dialog-float
    necesito un campo para p otro para tex are y otro para evento
    -->
    <paper-dialog id="dia" backdrop transition="core-transition-center">
      <p>
        -Are you sure?
      </p>

      <paper-tabs noink selectedindex="1" id="paper_tabs" class="transparent-teal" horizontal center layout>
        <paper-tab style="color: red;" on-click="{{dialog}}" id="paper_tab11" inline flex center-center horizontal layout>
          <core-icon icon="cancel" id="core_icon_button3"></core-icon>
          <span id="txt">Cancel</span>
        </paper-tab>
        <paper-tab style="color: green;" on-click="{{deletePost}}" id="paper_tab12" inline flex center-center horizontal layout>
          <core-icon icon="check" id="core_icon_button3"></core-icon>
          <span id="txt">Yes</span>
        </paper-tab>
      </paper-tabs>
    </paper-dialog>
    <paper-dialog id="addcomment" backdrop transition="core-transition-center">
      <p>
        -What do you want to say?
      </p>

      <textarea id="input2" rows="5" value="{{coments}}" maxlength="8000" aria-invalid="false" style="position: static; margin-top: 26px;" required></textarea>

      <paper-tabs noink selectedindex="1" id="paper_tabs" class="transparent-teal" horizontal center layout>
        <paper-tab style="color: red;" on-click="{{comment}}" id="paper_tab11" inline flex center-center horizontal layout>
          <core-icon icon="cancel" id="core_icon_button3"></core-icon>
          <span id="txt">Cancel</span>
        </paper-tab>
        <paper-tab style="color: green;" on-click="{{submit}}" id="paper_tab12" inline flex center-center horizontal layout>
          <core-icon icon="check" id="core_icon_button3"></core-icon>
          <span id="txt">Yes</span>
        </paper-tab>
      </paper-tabs>
    </paper-dialog>
    <paper-dialog id="edit" backdrop transition="core-transition-center">
      <p>-What do you want to write instead?</p>
      <input id="input" value="{{htitle}}" is="core-input" style="position: fixed;" required>
      <textarea id="input2" rows="5" value="{{content}}" maxlength="8000" aria-invalid="false" style="position: static; margin-top: 26px;" required></textarea>
      <paper-tabs noink selectedindex="1" id="paper_tabs" class="transparent-teal" horizontal center layout>
        <paper-tab style="color: red;" on-click="{{edit}}" id="paper_tab11" inline flex center-center horizontal layout>
          <core-icon icon="cancel" id="core_icon_button3"></core-icon>
          <span id="txt">Cancel</span>
        </paper-tab>
        <paper-tab style="color: green;" on-click="{{submit}}" id="paper_tab12" inline flex center-center horizontal layout>
          <core-icon icon="check" id="core_icon_button3"></core-icon>
          <span id="txt">Yes</span>
        </paper-tab>
      </paper-tabs>
    </paper-dialog>

  </template>

  <script>
    (function () {
        function loadPost() {
            var post = this.$.core-artc;
        }
        Polymer({
          domReady: function () {
            loadPost.bind(this);
            this.showDelete() ? this.show='true' : this.show='';

            /* TODO: sanitize this content and strip away
                 * unsafe HTML and any JS
                */
            this.$.content.innerHTML = this.content;

            var Arrcomentarios = [[user='pepe',coment='mwerthyjkcvbnm,'],[user='pepe2',coment='mwerthyjkcvbnm,2']]
            //como el que he echo en scaffold, este lo que hace es mirar si hay cambios de scroll y tal...
            //te lo explico cuando sea... que mas o menos lo he entendido, este se ve mejor que el de main-menu
            this.$.core_header_panel.addEventListener('scroll', function(e) {
              var scroller = e.detail.target;
              if(scroller.scrollTop === 0){
                this.lastElementChild.className="noheight";
              }else{
                this.lastElementChild.className="moreheight";
                this.firstElementChild.className="animate";
              }
            });
          },
          visiblecomments: function (){
            if(this.flag){
              this.$.comentarios.style.visibility = "visible";
              this.$.comentarios.style.height = "160px";
              this.flag=!this.flag;
            }else{
              this.$.comentarios.style.visibility = "hidden";
              this.$.comentarios.style.height = "0px";
              this.flag=!this.flag;
            }
          },
          flag: true,
          showDelete: function(){
            return document.URL.split('/').reverse()[0].split('=').reverse()[0] == this.owner;
          },
          dialog: function(){
            this.$.dia.toggle();
          },
          comment: function(){
            this.$.comment.toggle();
          },
          edit: function(){
            this.$.edit.toggle();
          },
          submit: function(){
            var datos={
              iduser: document.URL.split('/').reverse()[0].split('=').reverse()[0],
              title: this.$.input.value,
              content:this.$.input2.value,
              bgimg: this.bgimg,
              _id: this.idart
            }
            var ajaxhandler = this.$.ajaxhandler;
            ajaxhandler.editArticle(this,JSON.stringify(datos));
            this.$.edit.toggle();
          },
          deletePost: function(e,d,s){
            this.$.ajaxhandler.deleteArticles(this.idart,function(result){
              return result;
            });
            this.remove();
            this.dialog();
          },
          createComment: function(){
            this.$.comentsadd.style.display='none';
            this.$.inputcomment.style.display='flex';
          },
          sendComent: function(){
            console.log(this.$.inputadd.value);
            this.$.inputcomment.style.display='none';
            this.$.comentsadd.style.display='flex';
          }
        });
    })();
  </script>

</polymer-element>
