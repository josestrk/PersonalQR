<link rel="import" href="../core-artc/core-artc.html">
<link rel="import" href="../../bower_components/core-scroll-threshold/core-scroll-threshold.html">

<polymer-element name="core-list" attributes="lista">

  <template>
    <style>
        #lister{
/*            position: absolute;*/
            width: 80%;
            margin: 20px auto;
            height: auto;
            border: 1px solid red;
            overflow: auto;
        }
        @media(max-width:721px){
          #lister{
            width: 95%;
          }
        }

    </style>
    
      <core-scroll-threshold id="threshold" scrollTarget="{{$.lister}}" lowerTriggered="{{loadScroll}}"></core-scroll-threshold>
        <div id="lister" fit>
            <template repeat="{{item in lista}}"></template>
            <div hidden?="{{!$.threshold.lowerTriggered}}">Please wait...</div>
        </div>
  </template>

  <script>
    (function () {
      function createPage(item) {
          var section = document.createElement('core-artc');
          section.setAttribute('layout', '');
          section.setAttribute('vertical', '');
          section.setAttribute('htitle', item.title);
          section.setAttribute('content', item.content);
          section.setAttribute('date', item.date);
          section.setAttribute('bgimg', item.bgimg);
          section.setAttribute('owner', item.iduser);
          section.setAttribute('idart', item._id);
          section.setAttribute('coments', item.coments);


          var div = document.createElement('core-card');

          div.setAttribute('css', 'article');
          div.setAttribute('layout', '');
          div.setAttribute('vertical', '');

          div.appendChild(section);

          return div;
      }
      Polymer({
        skip: 0,
        status : '',
        domready: function(){
          var sk= this.skip;
          this.skip++;
          debugger
          this.lista.forEach(function (item) {
            this.$.lister.appendChild(createPage(item)); 
          });
        },
        debug: function(){
          var sk= this.skip;
          if(this.status!=='fin'){
              if(status==='fin'){
                this.status='fin';
              }
              if(lista){
                var listPost = this.$.lister;
                this.lista.forEach(function (item) {
                  listPost.appendChild(createPage(item));
                });
              }
          }
          this.skip++;
        },
        loadScroll: function() {
          console.log("LANZ LA MOVIDA");
          setTimeout(function() {
            debug;
            scope.$.threshold.clearLower();
          }, 1000);
        }
      });
    })();

  </script>

</polymer-element>