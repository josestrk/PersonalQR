<link rel="import" href="../../bower_components/core-signals/core-signals.html">
<polymer-element name="core-user">

<template>
  <style>
  </style>
  <core-signals  on-core-signal-userLoged="{{getUser}}"></core-signals>
</template>

<script>
  (function() {
      var datos={};

    Polymer({
      created: function(){
        if(localStorage.token !== undefined){
          this.getUser();
        }
        addEventListener('userLoged', function(e) {
          this.getUser();
        });
      },
      data:function(objeto){
        this.datos=objeto[0];
      },
      callUser: function(){
        this.getUser();
      },
      getUser: function(){
        function doAjax(options, success, error) {
          options.dataType = 'json';
          options.contentType = 'application/json; charset=UTF-8';
          options.success = success;
          options.error = (typeof error === 'function') ? error : defaultAjaxErrorHandler;

          options.beforeSend = function(xhr) {
            xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
          };

          $.ajax(options);
        }

        doAjax({
          type: 'GET',
          url: 'routes_user/profile',
        },function( result ) {
          this.datos = result;
          console.log(result);
        }.bind(this),
        function(xhr, err, desc){
          var errorToast = document.querySelector('#errorToast');
          errorToast.text = "Fallo al obtener el perfil de usuario";
          errorToast.show();
        });
      }
    });
  }());

</script>

</polymer-element>
