<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../core-ajax-handler.html">
<script src="jquery.typeahead.js" type="text/javascript"></script>

<polymer-element name="search-banner">
  <template>
    <style>
    @import 'jquery.typeahead.css';
    :host {
        height: 30px;
        border-radius: 20px;
        box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
        margin: 15px 15px 10px;
        padding: 2px 5px;
        border: 2px solid #fff;
        color: white;
        font-weight: 300;
    }
    #core_icon1 {
        height: 30px;
        width: 10%;
    }
    #core_input {
        width: 80%;
        padding: 10px;
    }
    </style>

  <div class="typeahead-container">
    <div class="typeahead-field">
      <span class="typeahead-query">
        <input id="q" name="q" type="search" placeholder="Search" autocomplete="off">
      </span>
    </div>
  </div>
  <core-icon icon="search" id="core_icon1"></core-icon>
  <core-ajax-handler id="ajaxhandler"></core-ajax-handler>

  </template>
  <script>
    (function () {
      var base = '/topic';

      function defaultAjaxErrorHandler(xhr, err, desc) {
        var errorToast = document.querySelector('#errorToast');
        errorToast.text = '[' + xhr.status + '] ' + desc + ': ' + xhr.response;
        errorToast.show();
      }

      function doAjax(options, success, error) {
        options.type = options.type || 'GET';
        options.url = base + (options.url || '');
        options.dataType = options.dataType || 'json';
        options.contentType = options.contentType || 'application/json; charset=UTF-8';
        options.success = success;
        options.error = (typeof error === 'function') ? error : defaultAjaxErrorHandler;
        $.ajax(options);
      }

      function search(){
        $(this.$.q).typeahead({
          minLength: 1,
          order: "asc",
          group: true,
          hint: true,
          list: false,
          backdrop: false,
          source: {
            topics: {
              data: topics
            }
          }
        });
      }

      var topics;

      Polymer('search-banner', {
        created: function() {
          // if (!topics) {
          //   debugger
          //   doAjax({}, function(data) {
          //
          //     (function () {
          //       var p = new Promise (
          //         function(resolve, reject) {
          //           topics = data;
          //         }
          //       );
          //     })();
          //
          //     this.topics = topics;
          //   }.bind(this));
          // }
        },
        ready: function () {
          this.$.q.onkeypress = function(event){
            console.log('Has introducido '+String.fromCharCode(event.charCode));
            console.log('Todos tus textos -> '+this.value+String.fromCharCode(event.charCode));
          };
          //this.arrayofTopics(this.$.q.onkeypress());
          search.bind(this)();
        },
        arrayofTopics: function(data){
          var ajaxhandler = this.$.ajaxhandler;
          var that=this;
          ajaxhandler.showTopics(data, function(result){
            debugger
            // $.each(that.topics, function(key, value) {
            //     this.topics.push(value);
            //   });
          });
        }
      });
    }());
  </script>
</polymer-element>
