<link rel="import" href="../../pages/wall-page.html">
<link rel="import" href="../../pages/myp-page.html">
<link rel="import" href="../../pages/config-page.html">
<link rel="import" href="../../pages/editor-page.html">

<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="../../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../../bower_components/core-menu/core-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../../bower_components/core-icons/image-icons.html">
<link rel="import" href="../../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../../bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../../../bower_components/core-a11y-keys/core-a11y-keys.html">
<link href="../../../bower_components/core-dropdown/core-dropdown.html" rel="import">
<link href="../../../bower_components/app-router/app-router.html" rel="import">

<link rel="stylesheet" href="style.css">
<link rel="import" href="../../../lib/flatiron-director/flatiron-director.html">
<link rel="import" href="../search-banner/search-banner.html">
<link rel="import" href="../id-card/id-card.html">
<link rel="import" href="../core-scaffold/core-scaffold.html">
<link rel="import" href="../core-notifi/core-notifi.html">


<polymer-element name="main-menu">
    <template>

        <style>
            core-menu {
                color: #FFF;
                margin: 0px 0px auto 0px;
                padding: 10px
            }
            core-menu > paper-item {
                transition: all 300ms ease-in-out;
            }
            core-menu > paper-item.core-selected {
                background: #777;
            }
            #pages{
                display: block;
                width: 100%;
                position: relative;
                height: 100%;
            }
            .dropdown {
                padding: 12px;
            }
        </style>
        <!-- Route controller. -->
        <flatiron-director route="{{route}}" autoHash></flatiron-director>

        <!-- Keyboard nav controller. -->
        <core-a11y-keys id="keys" target="{{parentElement}}"
                        keys="shift+up shift+down shift+left shift+right shift+space ctrl+shift+space"
                        on-keys-pressed="{{keyHandler}}"></core-a11y-keys>

        <my-core-scaffold id="scaffold">
            <nav>
                <core-card id="core_card" layout vertical>
                    <search-banner horizontal layout center-justified center></search-banner>
                    <id-card layout vertical center center-justified>
                        <img width="70" height="70" src="../../../img/avatar-01.svg">
                        <h2>User</h2>
                        <p>300 followers â€¢ 100 following</p>  
                        <!--<img src="{{post.avatar}}" width="70" height="70">
                        <h2>{{post.username}}</h2>
                        <p>{{post.text}}</p>-->
                    </id-card>
                </core-card>

                <core-menu valueattr="hash" selected="{{route}}" selectedModel="{{selectedPage}}"
                           on-core-select="{{menuItemSelected}}">
                    <template repeat="{{page in pages}}">
                        <paper-item icon="{{page.logo}}{{route != page.hash ? '' : '-outline'}}"
                                    label="{{page.name}}" hash="{{page.hash}}">
                            <a href="#{{page.hash}}"></a>
                        </paper-item>
                    </template>
                </core-menu>
                <core-card id="core_card_f" vertical layout end-justified end>    
                    <paper-icon-button icon="settings-power" id="paper_icon_button" ></paper-icon-button>
                </core-card>  
            </nav>

            <core-toolbar tool flex>
                <div flex>{{selectedPage.page.name}}</div>
                <core-notifi></core-notifi>
                <core-icon-button icon="image:blur-on"></core-icon-button>
            </core-toolbar>

            <div layout vertical fit>
                <app-router id="pages" mode="hash">
                    <template repeat="{{page in pages}}"></template>
                </app-router>
            </div>

        </my-core-scaffold>

    </template>
    <script>
        (function () {
            function createPage(page) {
                var section = document.createElement('app-route');
                section.setAttribute('layout', '');
                section.setAttribute('vertical', '');
                section.setAttribute('hash', page.hash);
                section.setAttribute('import', page.import);

                return section;
            }


            function loadPages() {
                var DEFAULT_ROUTE = 'wall';
                this.pages = [
                    {name: 'Wall', logo: 'info', hash: 'wall', import: '../../pages/wall-page.html'},
                    {name: 'My profile', logo: 'social:person', hash: 'myprofile', import: '../../pages/myp-page.html'},
                    {name: 'Edition Mode', logo: 'bookmark', hash: 'editor', import: '../../pages/editor-page.html'},
                    {name: 'Config', logo: 'check-circle', hash: 'settings', import: '../../pages/config-page.html'},
                    {name: 'Contacts', logo: 'social:person', hash: 'contacts', import: '../../pages/contacts-page.html'}
                ];

                var animatedPages = this.$.pages;

                this.pages.forEach(function (page) {
                    animatedPages.appendChild(createPage(page));
                });


                this.route = this.route || DEFAULT_ROUTE; // Select initial route.
            }

            function addKeysToNumbers() {
                var keys = this.$.keys;

                // Allow selecting pages by num keypad. Dynamically add
                // [1, template.pages.length] to key mappings.
                var keysToAdd = Array.apply(null, this.pages).map(function (x, i) {
                    return i + 1;
                }).reduce(function (x, y) {
                    return x + ' ' + y;
                });
                keys.keys += ' ' + keysToAdd;
            }

            Polymer({
                domReady: function () {
                    loadPages.bind(this)();
                    addKeysToNumbers.bind(this)();
                },
                keyHandler: function (e, detail, sender) {
                    var pages = this.$.pages;

                    // Select page by num key.
                    var num = parseInt(detail.key);
                    if (!isNaN(num) && num <= this.pages.length) {
                        pages.selectIndex(num - 1);
                        return;
                    }

                    switch (detail.key) {
                        case 'left':
                        case 'up':
                            pages.selectPrevious();
                            break;
                        case 'right':
                        case 'down':
                            pages.selectNext();
                            break;
                        case 'space':
                            detail.ctrl ? pages.selectPrevious() : pages.selectNext();
                            break;
                    }
                },
                menuItemSelected: function (e, detail, sender) {
                    if (detail.isSelected) {
                        this.$.scaffold.closeDrawer();
                    }
                }
            });
        }());
    </script>
</polymer-element>
