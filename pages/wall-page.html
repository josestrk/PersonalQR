<link rel="import" href="../core/core-ajax-handler.html">
<link rel="import" href="../core/core-list/core-list.html">

<polymer-element name="wall-page" attributes="userid">
  <template>
    <link type="text/css" rel="stylesheet" href="../core/lister.css">
    <core-ajax-handler id="ajaxhandler"></core-ajax-handler>
    <main-menu imenu="Wall" id="wall" iduser="{{id}}" logged="{{login.logged}}" progress="{{$.progress}}" on-endofpage="{{debug}}">
      <div class="title">Wall</div>
      <paper-progress id="progress"></paper-progress>
      <core-list id="list" lista="{{list}}"></core-list>
    </main-menu>
  </template>

  <script>
    (function () {
        function createPage(item) {
          var section = document.createElement('core-artc');
          section.setAttribute('layout', '');
          section.setAttribute('vertical', '');
          section.setAttribute('htitle', item.title);
          section.setAttribute('content', item.content);
          section.setAttribute('date', item.date);
          section.setAttribute('bgimg', item.bgimg);
          section.setAttribute('owner', item.iduser);
          section.setAttribute('idart', item._id);
          section.setAttribute('coments', item.coments);


          var div = document.createElement('core-card');

          div.setAttribute('css', 'article');
          div.setAttribute('layout', '');
          div.setAttribute('vertical', '');

          div.appendChild(section);

          return div;
        }

        Polymer({
          ready: function(){
            var that=this;
            var ajaxhandler = this.$.ajaxhandler;
            var sk= this.skip;

            ajaxhandler.getAllArticles(sk,function (result){
              if(result){
                that.list=result;
//                var listPost = that.$.list;
//                that.lista.forEach(function (item) {
//                  listPost.appendChild(createPage(item));
//                });
              }
            });
            this.skip++;
          },
          debug: function(){
            var that=this;
            var ajaxhandler = this.$.ajaxhandler;
            var sk= this.skip;
            if(this.status!=='fin'){
              ajaxhandler.getAllArticles(sk,function (result, status){
                if(status==='fin'){
                  that.status='fin';
                }
                if(result){
                  that.lista=result;
                  var listPost = that.$.list;
                  that.lista.forEach(function (item) {
                     listPost.appendChild(createPage(item));
                  });
                }
              });
            }
            this.skip++;
          },
          skip: 0,
          status : ''
        });
      })();
  </script>

</polymer-element>
