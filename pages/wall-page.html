<link rel="import" href="../core/core-ajax-handler.html">
<link rel="import" href="../core/core-list/core-list.html">
<link rel="import" href="../bower_components/core-scroll-threshold/core-scroll-threshold.html">


<polymer-element name="wall-page">
  <template>
    <core-ajax-handler id="ajaxhandler"></core-ajax-handler>
    
    <main-menu imenu="Wall" id="wall" logged="{{login.logged}}" progress="{{$.progress}}" on-endofpage="{{debug}}">
      <div class="title">Wall</div>
      <paper-progress id="progress"></paper-progress>
      <core-scroll-threshold id="threshold" scrollTarget="{{$.list}}" lowerThreshold="100" on-lower-trigger="{{loadMore}}" fit></core-scroll-threshold>
      <core-list id="list" lista="{{lista}}"></core-list>
      <div hidden?="{{!$.threshold.lowerTriggered}}">Please wait...</div>
    </main-menu>
    
  </template>

  <script>
    (function () {
      Polymer({
        ready: function(){
            var lista=[];  
            var that=this;
            var ajaxhandler = this.$.ajaxhandler;
            var sk= this.skip;
          
            ajaxhandler.getAllArticles(sk,function (result){
              if(result){
                that.lista=result;
                that.fire('resultado-recuperado',result);
              }
            });
            this.skip++;
         },
         debug: function(){
            var that=this;
            var ajaxhandler = this.$.ajaxhandler;
            var sk= this.skip;
            if(this.status!=='fin'){
              ajaxhandler.getAllArticles(sk,function (result, status){
                if(status==='fin'){
                  that.status='fin';
                }
                if(result){
                  that.lista=result;
                }
              });
            }
            this.skip++;
         },
         loadMore: function() {
          /* make AJAX load call here using core-ajax, etc. */
          console.log("LANZ LA MOVIDA");
          setTimeout(function() {
            this.fire('endofpage');
            this.$.threshold.clearLower();
          }, 1000);
         },
         skip: 0,
         status : ''
        });
      })();
  </script>

</polymer-element>
